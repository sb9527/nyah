(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{114:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(6),i=n.n(r),o=(n(83),n(44)),u=n(25),l=n(14),s=Object(l.a)(),d=(n(84),n(9)),h=n(139),p=n(142),m=n(67),f=n.n(m),E=n(144),b=n(143),v=n(145),g=n(4),O=Object(h.a)((function(e){return{avatar:{position:"fixed",top:20,right:50}}}));function j(){var e=Object(g.useSelector)((function(e){return{isAuthenticated:e.auth.isAuthenticated,auth0:e.auth.auth0,loading:e.auth.loading,user:e.user}}),g.shallowEqual),t=e.isAuthenticated,n=e.auth0,a=e.loading,r=e.user,i=O(),o=c.a.useState(null),u=Object(d.a)(o,2),l=u[0],h=u[1],m=Boolean(l);return a?c.a.createElement("div",null,"loading"):c.a.createElement("div",{className:i.avatar},t&&c.a.createElement("div",null,c.a.createElement(v.a,{alt:"user",onClick:function(e){h(e.currentTarget)},src:r.picture_url}),c.a.createElement(b.a,{id:"menu-appbar",anchorEl:l,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:m,onClose:function(){h(null)}},c.a.createElement(E.a,{onClick:function(){return s.push("./profile")}},"Profile"),c.a.createElement(E.a,{onClick:function(){return n.logout()}},"Log Out"))),!t&&c.a.createElement("div",null,c.a.createElement(p.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(){return n.loginWithRedirect({})},color:"inherit"},c.a.createElement(f.a,null))))}var w=n(49),S=n.n(w),_=n(68),y=n.n(_);n(90);S.a.registerLanguage("json",y.a);var k=function(){var e=Object(g.useSelector)((function(e){return{loading:e.auth.loading,user:e.user,auth0:e.auth.auth0}}),g.shallowEqual),t=e.loading,n=e.user,r=e.auth0,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){i&&i.current&&S.a.highlightBlock(i.current),r.getTokenSilently().then((function(e){return console.log("token:",e)}))})),t||!n?c.a.createElement("div",null,"loading"):c.a.createElement(a.Fragment,null,c.a.createElement("img",{src:n.picture,alt:"avatar"}),c.a.createElement("h2",null,n.nickname),c.a.createElement("p",null,n.email),c.a.createElement("pre",null,c.a.createElement("code",{ref:i,className:"json",style:{textAlign:"left"}},JSON.stringify(n,null,1))))},T=n(11),x=n.n(T);var A=function(e){var t=e.component,n=e.path,r=Object(o.a)(e,["component","path"]),i=Object(g.useSelector)((function(e){return{isAuthenticated:e.auth.isAuthenticated,auth0:e.auth.auth0,loading:e.auth.loading}}),g.shallowEqual),l=i.isAuthenticated,s=i.auth0,d=i.loading;return Object(a.useEffect)((function(){if(!d&&!l&&s.loginWithRedirect){!function(e){x.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.a.awrap(s.loginWithRedirect({appState:{targetUrl:e}}));case 2:case"end":return t.stop()}}))}(n)}}),[l,s,n,d]),c.a.createElement(u.b,Object.assign({path:n},r,{component:l?t:null}))},N=n(19);var C=function(){return c.a.createElement("div",{className:"nav"},c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(N.b,{to:"/",exact:!0},"Home")),c.a.createElement("li",null,c.a.createElement(N.b,{to:"/new"},"New Voice"))))},L=n(72),I=n.n(L),U=n(71),R=n.n(U),D=n(70),P=n.n(D),V=n(24),q=n(8),B=n(38),W=n.n(B),G="http://localhost:5000",z="/users",H="/voices";function J(e){W.a.interceptors.request.use((function(t){return t.headers=Object(q.a)({},t.headers,{Authorization:"Bearer ".concat(e)}),t}),(function(e){return Promise.reject(e)}))}function K(e){var t=e.auth0_user_id,n=e.nickname,a=e.picture_url;return W()({url:G+z,method:"POST",headers:{"content-type":"application/json",Accept:"application/json"},data:{auth0_user_id:t,nickname:n,picture_url:a}}).then((function(e){return e.data}))}var M=n(13),Y=n.n(M);function F(e){return{type:"TOGGLE_LIKE",id:e.id,authedUser:e.authedUser}}function X(e){return function(t,n){t(Object(M.showLoading)());var a=n().user.id;t(F({id:e,authedUser:a})),function(e){var t=e.voice_id,n=e.user_id;return W()({url:"".concat(G,"/voices/").concat(t,"/like"),method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{user_id:n}})}({voice_id:e,user_id:a}).then((function(){})).catch((function(){t(F({id:e,authedUser:a}))})).then((function(){t(Object(M.hideLoading)())}))}}function $(e,t,n){return function(a,c){a(Object(M.showLoading)());var r=c().user.id;(function(e){var t=e.text,n=e.author_id,a=e.replying_to,c=void 0===a?null:a,r=e.pictures,i=void 0===r?null:r;return W()({url:G+H,method:"POST",headers:{"content-type":"application/json",Accept:"application/json"},data:{text:t,author_id:n,replying_to:c,pictures:i}}).then((function(e){return e.data}))})({text:e,author_id:r,replying_to:t}).then((function(e){a({type:"ADD_VOICE",voice:e.voice}),n(),a(Object(M.hideLoading)())})).catch((function(e){a(Object(M.hideLoading)()),n()}))}}function Q(){return function(e){e(Object(M.showLoading)()),console.log("handleReceiveVoices!"),function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],W()({url:G+H+"?page=1"}).then((function(e){return e.data}))}().then((function(t){var n=t.voices.reduce((function(e,t){return Object(q.a)({},e,Object(V.a)({},t.id,t))}),{});e({type:"RECEIVE_VOICES",voices:n}),e(Object(M.hideLoading)())}))}}function Z(e){var t=e.id,n=Object(g.useSelector)((function(e){return e.voices}),g.shallowEqual),r=Object(g.useSelector)((function(e){return e.voices[t]}),g.shallowEqual),i=Object(g.useSelector)((function(e){return e.user.id})),o=Object(g.useDispatch)(),u=Object(g.useSelector)((function(e){return e.auth})),l=Object(a.useState)(),h=Object(d.a)(l,2),p=h[0],m=h[1],f=Object(a.useState)(),E=Object(d.a)(f,2),b=E[0],v=E[1],O=Object(a.useState)(),j=Object(d.a)(O,2),w=j[0],S=j[1],_=Object(a.useState)(),y=Object(d.a)(_,2),k=y[0],T=y[1],A=Object(a.useState)(),C=Object(d.a)(A,2),L=C[0],U=C[1],D=Object(a.useState)(),V=Object(d.a)(D,2),q=V[0],B=V[1],W=Object(a.useState)(),G=Object(d.a)(W,2),z=G[0],H=G[1],J=Object(a.useState)(),K=Object(d.a)(J,2),M=K[0],Y=K[1];Object(a.useEffect)((function(){r&&(m(r.author.picture_url),v(r.author.nickname),S(r.text),T(r.likes.includes(i)),U(r.likes.length),B(r.replies.length),H(r.create_time),r.replying_to&&Y(n[r.replying_to]))}),[t,n,i,o,r,M]);return c.a.createElement("div",null,c.a.createElement(N.a,{className:"tweet",to:"/".concat(t)},c.a.createElement("div",{style:{backgroundImage:"url(".concat(p,")"),backgroundSize:"cover",backgroundPosition:"center"},alt:"Avatar of ".concat(b),className:"avatar"}),c.a.createElement("div",{className:"tweet-info"},c.a.createElement("div",null,c.a.createElement("span",null,b),c.a.createElement("div",null,function(e){var t=new Date(1e3*e);return t.toLocaleTimeString("zh-CN")+" | "+t.toLocaleDateString()}(z)),M&&c.a.createElement("button",{className:"replying-to",onClick:function(e){e.preventDefault(),s.push("/".concat(M.id))}},"\u56de\u590d @",M.author.nickname),c.a.createElement("p",null,w)),c.a.createElement("div",{className:"tweet-icons"},c.a.createElement(P.a,{className:"tweet-icon"}),c.a.createElement("span",null,0!==q&&q),c.a.createElement("button",{className:"heart-button",onClick:function(e){return function(e){if(e.preventDefault(),u.isAuthenticated)o(X(t));else{n=window.location.pathname,x.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.awrap(u.auth0.loginWithRedirect({appState:{targetUrl:n}}));case 2:case"end":return e.stop()}}))}var n}(e)}},!0===k?c.a.createElement(R.a,{className:"tweet-icon",style:{color:"#e0245e"}}):c.a.createElement(I.a,{className:"tweet-icon"})),c.a.createElement("span",null,0!==L&&L)))))}function ee(){var e=Object(g.useSelector)((function(e){return e.voices}));return c.a.createElement("div",null,c.a.createElement("ul",null,Object.keys(e).sort((function(e,t){return t.create_time-e.create_time})).map((function(e){return c.a.createElement("li",{key:e},c.a.createElement(Z,{id:e}))}))))}function te(e){var t=Object(g.useSelector)((function(e){return e.auth})),n=Object(a.useState)(""),r=Object(d.a)(n,2),i=r[0],o=r[1],l=Object(a.useState)(),s=Object(d.a)(l,2),h=s[0],p=s[1],m=Object(a.useState)(120-i.length),f=Object(d.a)(m,2),E=f[0],b=f[1],v=Object(g.useDispatch)();Object(a.useEffect)((function(){b(120-i.length)}),[i]);return!0===h?c.a.createElement(u.a,{exact:!0,to:"/"}):c.a.createElement("div",null,c.a.createElement("h1",{className:"center"},"New Voice"),c.a.createElement("form",{className:"new-tweet",onSubmit:function(n){if(n.preventDefault(),t.isAuthenticated){var a=e.replyingTo;v($(i,a,(function(){o(""),p(!a)})))}else{c=window.location.pathname,x.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.awrap(t.auth0.loginWithRedirect({appState:{targetUrl:c}}));case 2:case"end":return e.stop()}}))}var c}},c.a.createElement("textarea",{className:"textarea",maxLength:"120",value:i,onChange:function(e){var t=e.target.value;o(t),p(!1)}}),E<=100&&c.a.createElement("div",{className:"tweet-length"},E),c.a.createElement("button",{type:"submit",className:"btn"},"Submit")))}function ne(e){var t=e.match.params.id,n=Object(g.useSelector)((function(e){return e.voices[t]}),g.shallowEqual),r=Object(a.useState)([]),i=Object(d.a)(r,2),o=i[0],u=i[1];return Object(a.useEffect)((function(){n&&u(n.replies?n.replies:[])}),[t,n]),n?c.a.createElement("div",null,c.a.createElement(Z,{id:t}),c.a.createElement(te,{replyingTo:t}),0!==o.length&&c.a.createElement("ul",null,o.map((function(e){return c.a.createElement("li",{key:e},c.a.createElement(Z,{id:e}))})))):c.a.createElement("div",null,"this voice does not exist. ")}var ae=function(){return c.a.createElement("div",null,c.a.createElement(C,null),c.a.createElement(u.d,null,c.a.createElement(u.b,{exact:!0,path:"/",component:ee}),c.a.createElement(u.b,{path:"/new",component:te}),c.a.createElement(u.b,{path:"/:id",component:ne})))},ce=n(73),re=n.n(ce);function ie(e){return{type:"SET_IS_AUTHENTICATED",isAuthenticated:e}}function oe(e){return{type:"SET_USER",user:e}}function ue(e,t){return function(n){n(function(e,t){return function(n){!function(){var a,c,r,i,o;x.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return n(Object(M.showLoading)()),u.next=3,x.a.awrap(re()(e));case 3:if(a=u.sent,n({type:"SET_AUTH0",auth0:a}),!window.location.search.includes("code=")||!window.location.search.includes("state=")){u.next=11;break}return u.next=8,x.a.awrap(a.handleRedirectCallback());case 8:c=u.sent,r=c.appState,t(r);case 11:return u.next=13,x.a.awrap(a.isAuthenticated());case 13:if(i=u.sent,n(ie(i)),!i){u.next=22;break}return u.next=18,x.a.awrap(a.getUser());case 18:return o=u.sent,u.next=21,x.a.awrap(K({auth0_user_id:o.sub,nickname:o.nickname,picture_url:o.picture}).then((function(e){n(oe(e.user))})));case 21:a.getTokenSilently().then((function(e){return J(e)}));case 22:n(Object(M.hideLoading)()),n({type:"SET_LOADING",loading:!1});case 24:case"end":return u.stop()}}))}()}}(e,t)),n(Q())}}var le=function(){return window.history.replaceState({},document.title,window.location.pathname)};var se=function(e){var t=e.onRedirectCallback,n=void 0===t?le:t,r=Object(o.a)(e,["onRedirectCallback"]),i=Object(g.useDispatch)();return Object(a.useEffect)((function(){i(ue(r,n))})),c.a.createElement("div",{className:"App"},c.a.createElement(u.c,{history:s},c.a.createElement(Y.a,null),c.a.createElement("header",null,c.a.createElement(j,null)),c.a.createElement("main",{className:"main"},c.a.createElement(u.d,null,c.a.createElement(A,{exact:!0,path:"/profile",component:k}),c.a.createElement(u.b,{path:"/",component:ae})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var de=n(45),he=n(22);var pe=n(52);var me=Object(he.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return Object(q.a)({},t.user);default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_IS_AUTHENTICATED":return Object(q.a)({},e,{isAuthenticated:t.isAuthenticated});case"SET_AUTH0":return Object(q.a)({},e,{auth0:t.auth0});case"SET_LOADING":return Object(q.a)({},e,{loading:t.loading});case"SET_POPUP_OPEN":return Object(q.a)({},e,{popupOpen:t.popupOpen});default:return e}},voices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_VOICES":return Object(q.a)({},e,{},t.voices);case"ADD_VOICE":var n=t.voice,a={};return n.replying_to&&(a=Object(V.a)({},n.replying_to,Object(q.a)({},e[n.replying_to],{replies:[].concat(Object(pe.a)(e[n.replying_to].replies),[n.id])}))),Object(q.a)({},e,Object(V.a)({},n.id,n),a);case"TOGGLE_LIKE":var c=t.id,r=t.authedUser,i=e[c].likes.includes(r);return Object(q.a)({},e,Object(V.a)({},c,Object(q.a)({},e[c],{likes:i?e[c].likes.filter((function(e){return e!==r})):[].concat(Object(pe.a)(e[c].likes),[r])})));default:return e}},loadingBar:M.loadingBarReducer}),fe=n(74),Ee=function(e){return function(t){return function(n){console.group(n.type),console.log("the action is : ",n);var a=t(n);return console.log("the state is : ",e.getState()),console.groupEnd(),a}}},be=Object(he.a)(fe.a,Ee),ve=Object(he.d)(me,be);i.a.render(c.a.createElement(g.Provider,{store:ve},c.a.createElement(se,{domain:de.domain,client_id:de.clientId,audience:de.audience,redirect_uri:window.location.origin,onRedirectCallback:function(e){s.push(e&&e.targetUrl?e.targetUrl:window.location.pathname)}})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},45:function(e){e.exports=JSON.parse('{"domain":"ffee.auth0.com","clientId":"ogpRnMvjuKOvYktkIrny9uvfT2XETYCw","audience":"https://nyah.com"}')},78:function(e,t,n){e.exports=n(114)},83:function(e,t,n){},84:function(e,t,n){}},[[78,1,2]]]);
//# sourceMappingURL=main.ac85a707.chunk.js.map