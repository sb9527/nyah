(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{43:function(e){e.exports=JSON.parse('{"domain":"ffee.auth0.com","clientId":"ogpRnMvjuKOvYktkIrny9uvfT2XETYCw","audience":"https://nyah.com"}')},67:function(e,t,n){e.exports=n(88)},72:function(e,t,n){},73:function(e,t,n){},88:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(6),i=n.n(r),o=(n(72),n(42)),u=n(24),l=n(14),s=Object(l.a)(),d=(n(73),n(8)),h=n(113),p=n(116),m=n(56),f=n.n(m),E=n(118),b=n(117),v=n(119),g=n(4),O=Object(h.a)((function(e){return{avatar:{position:"fixed",top:20,right:50}}}));function j(){var e=Object(g.useSelector)((function(e){return{isAuthenticated:e.auth.isAuthenticated,auth0:e.auth.auth0,loading:e.auth.loading,user:e.user}}),g.shallowEqual),t=e.isAuthenticated,n=e.auth0,a=e.loading,r=e.user,i=O(),o=c.a.useState(null),u=Object(d.a)(o,2),l=u[0],h=u[1],m=Boolean(l);return a?c.a.createElement("div",null,"loading"):c.a.createElement("div",{className:i.avatar},t&&c.a.createElement("div",null,c.a.createElement(v.a,{alt:"user",onClick:function(e){h(e.currentTarget)},src:r.picture_url}),c.a.createElement(b.a,{id:"menu-appbar",anchorEl:l,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:m,onClose:function(){h(null)}},c.a.createElement(E.a,{onClick:function(){return s.push("./profile")}},"Profile"),c.a.createElement(E.a,{onClick:function(){return n.logout()}},"Log Out"))),!t&&c.a.createElement("div",null,c.a.createElement(p.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(){return n.loginWithRedirect({})},color:"inherit"},c.a.createElement(f.a,null))))}var w=n(47),S=n.n(w),y=n(57),_=n.n(y);n(79);S.a.registerLanguage("json",_.a);var k=function(){var e=Object(g.useSelector)((function(e){return{loading:e.auth.loading,user:e.user,auth0:e.auth.auth0}}),g.shallowEqual),t=e.loading,n=e.user,r=e.auth0,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){i&&i.current&&S.a.highlightBlock(i.current),r.getTokenSilently().then((function(e){return console.log("token:",e)}))})),t||!n?c.a.createElement("div",null,"loading"):c.a.createElement(a.Fragment,null,c.a.createElement("img",{src:n.picture,alt:"avatar"}),c.a.createElement("h2",null,n.nickname),c.a.createElement("p",null,n.email),c.a.createElement("pre",null,c.a.createElement("code",{ref:i,className:"json",style:{textAlign:"left"}},JSON.stringify(n,null,1))))},N=n(10),x=n.n(N);var T=function(e){var t=e.component,n=e.path,r=Object(o.a)(e,["component","path"]),i=Object(g.useSelector)((function(e){return{isAuthenticated:e.auth.isAuthenticated,auth0:e.auth.auth0,loading:e.auth.loading}}),g.shallowEqual),l=i.isAuthenticated,s=i.auth0,d=i.loading;return Object(a.useEffect)((function(){if(!d&&!l&&s.loginWithRedirect){!function(e){x.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.a.awrap(s.loginWithRedirect({appState:{targetUrl:e}}));case 2:case"end":return t.stop()}}))}(n)}}),[l,s,n,d]),c.a.createElement(u.b,Object.assign({path:n},r,{component:l?t:null}))},A=n(18);var C=function(){return c.a.createElement("div",{className:"nav"},c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(A.b,{to:"/",exact:!0},"Home")),c.a.createElement("li",null,c.a.createElement(A.b,{to:"/new"},"New Voice"))))},I=n(61),L=n.n(I),U=n(60),D=n.n(U),R=n(59),P=n.n(R),V=n(23),J=n(12),W="https://nyah.herokuapp.com/",q="/users",B="/voices";function G(e){var t=e.auth0_user_id,n=e.nickname,a=e.picture_url;return fetch(W+q,{method:"POST",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({auth0_user_id:t,nickname:n,picture_url:a})}).then((function(e){return e.json()}))}var H=n(13),z=n.n(H);function K(e){return{type:"TOGGLE_LIKE",id:e.id,authedUser:e.authedUser}}function M(e){return function(t,n){t(Object(H.showLoading)());var a=n().user.id;t(K({id:e,authedUser:a})),function(e){var t=e.voice_id,n=e.user_id;return fetch("".concat(W,"/voices/").concat(t,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({user_id:n})})}({voice_id:e,user_id:a}).then((function(){})).catch((function(){t(K({id:e,authedUser:a}))})).then((function(){t(Object(H.hideLoading)())}))}}function Y(e,t,n){return function(a,c){a(Object(H.showLoading)());var r=c().user.id;(function(e){var t=e.text,n=e.author_id,a=e.replying_to,c=void 0===a?null:a,r=e.pictures,i=void 0===r?null:r;return fetch(W+B,{method:"POST",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({text:t,author_id:n,replying_to:c,pictures:i})}).then((function(e){return e.json()}))})({text:e,author_id:r,replying_to:t}).then((function(e){a({type:"ADD_VOICE",voice:e.voice}),n(),a(Object(H.hideLoading)())}))}}function F(){return function(e){e(Object(H.showLoading)()),function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],fetch(W+B+"?page=1").then((function(e){return e.json()}))}().then((function(t){var n=t.voices.reduce((function(e,t){return Object(J.a)({},e,Object(V.a)({},t.id,t))}),{});e({type:"RECEIVE_VOICES",voices:n}),e(Object(H.hideLoading)())}))}}function X(e){var t=e.id,n=Object(g.useSelector)((function(e){return e.voices}),g.shallowEqual),r=Object(g.useSelector)((function(e){return e.voices[t]}),g.shallowEqual),i=Object(g.useSelector)((function(e){return e.user.id})),o=Object(g.useDispatch)(),u=Object(g.useSelector)((function(e){return e.auth})),l=Object(a.useState)(),h=Object(d.a)(l,2),p=h[0],m=h[1],f=Object(a.useState)(),E=Object(d.a)(f,2),b=E[0],v=E[1],O=Object(a.useState)(),j=Object(d.a)(O,2),w=j[0],S=j[1],y=Object(a.useState)(),_=Object(d.a)(y,2),k=_[0],N=_[1],T=Object(a.useState)(),C=Object(d.a)(T,2),I=C[0],U=C[1],R=Object(a.useState)(),V=Object(d.a)(R,2),J=V[0],W=V[1],q=Object(a.useState)(),B=Object(d.a)(q,2),G=B[0],H=B[1],z=Object(a.useState)(),K=Object(d.a)(z,2),Y=K[0],F=K[1];Object(a.useEffect)((function(){r&&(m(r.author.picture_url),v(r.author.nickname),S(r.text),N(r.likes.includes(i)),U(r.likes.length),W(r.replies.length),H(r.create_time),r.replying_to&&F(n[r.replying_to]))}),[t,n,i,o,r,Y]);return c.a.createElement("div",null,c.a.createElement(A.a,{className:"tweet",to:"/".concat(t)},c.a.createElement("div",{style:{backgroundImage:"url(".concat(p,")"),backgroundSize:"cover",backgroundPosition:"center"},alt:"Avatar of ".concat(b),className:"avatar"}),c.a.createElement("div",{className:"tweet-info"},c.a.createElement("div",null,c.a.createElement("span",null,b),c.a.createElement("div",null,function(e){var t=new Date(1e3*e);return t.toLocaleTimeString("zh-CN")+" | "+t.toLocaleDateString()}(G)),Y&&c.a.createElement("button",{className:"replying-to",onClick:function(e){e.preventDefault(),s.push("/".concat(Y.id))}},"\u56de\u590d @",Y.author.nickname),c.a.createElement("p",null,w)),c.a.createElement("div",{className:"tweet-icons"},c.a.createElement(P.a,{className:"tweet-icon"}),c.a.createElement("span",null,0!==J&&J),c.a.createElement("button",{className:"heart-button",onClick:function(e){return function(e){if(e.preventDefault(),u.isAuthenticated)o(M(t));else{n=window.location.pathname,x.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.awrap(u.auth0.loginWithRedirect({appState:{targetUrl:n}}));case 2:case"end":return e.stop()}}))}var n}(e)}},!0===k?c.a.createElement(D.a,{className:"tweet-icon",style:{color:"#e0245e"}}):c.a.createElement(L.a,{className:"tweet-icon"})),c.a.createElement("span",null,0!==I&&I)))))}function $(){var e=Object(g.useSelector)((function(e){return e.voices}));return c.a.createElement("div",null,c.a.createElement("ul",null,Object.keys(e).sort((function(e,t){return t.create_time-e.create_time})).map((function(e){return c.a.createElement("li",{key:e},c.a.createElement(X,{id:e}))}))))}function Q(e){var t=Object(g.useSelector)((function(e){return e.auth})),n=Object(a.useState)(""),r=Object(d.a)(n,2),i=r[0],o=r[1],l=Object(a.useState)(),s=Object(d.a)(l,2),h=s[0],p=s[1],m=Object(a.useState)(120-i.length),f=Object(d.a)(m,2),E=f[0],b=f[1],v=Object(g.useDispatch)();Object(a.useEffect)((function(){b(120-i.length)}),[i]);return!0===h?c.a.createElement(u.a,{exact:!0,to:"/"}):c.a.createElement("div",null,c.a.createElement("h1",{className:"center"},"New Voice"),c.a.createElement("form",{className:"new-tweet",onSubmit:function(n){if(n.preventDefault(),t.isAuthenticated){var a=e.replyingTo;v(Y(i,a,(function(){o(""),p(!a)})))}else{c=window.location.pathname,x.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.awrap(t.auth0.loginWithRedirect({appState:{targetUrl:c}}));case 2:case"end":return e.stop()}}))}var c}},c.a.createElement("textarea",{className:"textarea",maxLength:"120",value:i,onChange:function(e){var t=e.target.value;o(t),p(!1)}}),E<=100&&c.a.createElement("div",{className:"tweet-length"},E),c.a.createElement("button",{type:"submit",className:"btn"},"Submit")))}function Z(e){var t=e.match.params.id,n=Object(g.useSelector)((function(e){return e.voices[t]}),g.shallowEqual),r=Object(a.useState)([]),i=Object(d.a)(r,2),o=i[0],u=i[1];return Object(a.useEffect)((function(){n&&u(n.replies?n.replies:[])}),[t,n]),n?c.a.createElement("div",null,c.a.createElement(X,{id:t}),c.a.createElement(Q,{replyingTo:t}),0!==o.length&&c.a.createElement("ul",null,o.map((function(e){return c.a.createElement("li",{key:e},c.a.createElement(X,{id:e}))})))):c.a.createElement("div",null,"this voice does not exist. ")}var ee=function(){return c.a.createElement("div",null,c.a.createElement(C,null),c.a.createElement(u.d,null,c.a.createElement(u.b,{exact:!0,path:"/",component:$}),c.a.createElement(u.b,{path:"/new",component:Q}),c.a.createElement(u.b,{path:"/:id",component:Z})))},te=n(62),ne=n.n(te);function ae(e){return{type:"SET_IS_AUTHENTICATED",isAuthenticated:e}}function ce(e){return{type:"SET_USER",user:e}}function re(e,t){return function(n){n(function(e,t){return function(n){!function(){var a,c,r,i,o;x.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return n(Object(H.showLoading)()),u.next=3,x.a.awrap(ne()(e));case 3:if(a=u.sent,n({type:"SET_AUTH0",auth0:a}),!window.location.search.includes("code=")||!window.location.search.includes("state=")){u.next=11;break}return u.next=8,x.a.awrap(a.handleRedirectCallback());case 8:c=u.sent,r=c.appState,t(r);case 11:return u.next=13,x.a.awrap(a.isAuthenticated());case 13:if(i=u.sent,n(ae(i)),!i){u.next=21;break}return u.next=18,x.a.awrap(a.getUser());case 18:return o=u.sent,u.next=21,x.a.awrap(G({auth0_user_id:o.sub,nickname:o.nickname,picture_url:o.picture}).then((function(e){n(ce(e.user))})));case 21:n(Object(H.hideLoading)()),n({type:"SET_LOADING",loading:!1});case 23:case"end":return u.stop()}}))}()}}(e,t)),n(F())}}var ie=function(){return window.history.replaceState({},document.title,window.location.pathname)};var oe=function(e){var t=e.onRedirectCallback,n=void 0===t?ie:t,r=Object(o.a)(e,["onRedirectCallback"]),i=Object(g.useDispatch)();return Object(a.useEffect)((function(){i(re(r,n))})),c.a.createElement("div",{className:"App"},c.a.createElement(u.c,{history:s},c.a.createElement(z.a,null),c.a.createElement("header",null,c.a.createElement(j,null)),c.a.createElement("main",{className:"main"},c.a.createElement(u.d,null,c.a.createElement(T,{exact:!0,path:"/profile",component:k}),c.a.createElement(u.b,{path:"/",component:ee})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ue=n(43),le=n(21);var se=n(50);var de=Object(le.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return Object(J.a)({},t.user);default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_IS_AUTHENTICATED":return Object(J.a)({},e,{isAuthenticated:t.isAuthenticated});case"SET_AUTH0":return Object(J.a)({},e,{auth0:t.auth0});case"SET_LOADING":return Object(J.a)({},e,{loading:t.loading});case"SET_POPUP_OPEN":return Object(J.a)({},e,{popupOpen:t.popupOpen});default:return e}},voices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_VOICES":return Object(J.a)({},e,{},t.voices);case"ADD_VOICE":var n=t.voice,a={};return n.replying_to&&(a=Object(V.a)({},n.replying_to,Object(J.a)({},e[n.replying_to],{replies:[].concat(Object(se.a)(e[n.replying_to].replies),[n.id])}))),Object(J.a)({},e,Object(V.a)({},n.id,n),a);case"TOGGLE_LIKE":var c=t.id,r=t.authedUser,i=e[c].likes.includes(r);return Object(J.a)({},e,Object(V.a)({},c,Object(J.a)({},e[c],{likes:i?e[c].likes.filter((function(e){return e!==r})):[].concat(Object(se.a)(e[c].likes),[r])})));default:return e}},loadingBar:H.loadingBarReducer}),he=n(63),pe=function(e){return function(t){return function(n){console.group(n.type),console.log("the action is : ",n);var a=t(n);return console.log("the state is : ",e.getState()),console.groupEnd(),a}}},me=Object(le.a)(he.a,pe),fe=Object(le.d)(de,me);i.a.render(c.a.createElement(g.Provider,{store:fe},c.a.createElement(oe,{domain:ue.domain,client_id:ue.clientId,audience:ue.audience,redirect_uri:window.location.origin,onRedirectCallback:function(e){s.push(e&&e.targetUrl?e.targetUrl:window.location.pathname)}})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[67,1,2]]]);
//# sourceMappingURL=main.c5734159.chunk.js.map